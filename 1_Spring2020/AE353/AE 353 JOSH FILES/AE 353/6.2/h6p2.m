%% 6.2.1
clear all ; clc
A = [-0.90 0.10 0.40 -0.60; 0.00 0.60 -0.80 -0.10; 0.00 0.00 0.60 -0.60; -0.70 0.80 0.70 0.90];
B = [-0.90; 0.60; -0.80; -0.40];
C = [-0.60 0.60 0.70 -0.60];
K = [-10.50 24.90 7.60 27.10];
L = [40.10; -195.40; 131.40; -96.00];

[m,n] = size(C);
kref=-inv(C*inv(A-B*K)*B);

F=[A -B*K;L*C A-B*K-L*C];
G=[B*kref;B*kref];
H=[C zeros(1,n)];
disp(mat2str(F))
disp(mat2str(G))
disp(mat2str(H))
%% 6.2.2
clear all ; clc
A = [0.80 0.70 -0.90 0.20; -0.10 0.30 -0.60 0.70; 0.00 0.10 -0.90 0.10; -0.90 -0.60 -0.70 0.40];
B = [-0.60; 0.60; -0.60; 0.90];
C = [-0.90 0.60 -0.20 0.30];
K = [7.40 4.90 -6.20 3.30];
L = [-125.90; 26.40; 188.30; -251.60];

kref=-inv(C*inv(A-B*K)*B);

F=[A-B*K -B*K;zeros(size(A)) A-L*C];
G=[B*kref;zeros(length(B*kref),1)];
H=[C zeros(1,length(C))];
disp(mat2str(F))
disp(mat2str(G))
disp(mat2str(H))
%% 6.2.3
clear all ; clc
A = [0.10 -0.80 0.00 0.40; 0.60 -0.60 0.70 -0.80; -0.80 -0.10 -0.10 0.90; 0.70 0.40 -0.10 0.70];
B = [0.00; -0.50; -0.70; -0.40];
C = [0.00 -0.50 -0.60 -0.90];
K = [-160.10 48.80 47.80 -165.10];
L = [95.10; 81.60; 223.00; -208.40];
x0 = [0.10; -0.90; -0.60; 0.20];
xhat0 = [0.50; -1.90; 0.30; 0.40];
t0 = 0.50;
t1 = 0.60;

[m,n] = size(A);
F=[A-B*K -B*K;zeros(size(A)) A-L*C];
sol=expm(F*(t1-t0))*[x0;xhat0-x0];
xt1=sol(1:n);
xhat1=sol(n+1:2*n)+xt1;

disp(mat2str(xt1))
disp(mat2str(xhat1))
%% 6.2.4
clear all ; clc
A = [0.0 -0.2 -0.6; 0.4 -0.3 0.5; 0.4 0.0 0.1];
B = [0.3; 0.7; 0.9];
C = [-0.5 0.2 -0.4];
K1 = [-352.7 -984.2 898.5];
K2 = [-57.4 -191.7 170.1];
K3 = [-104.3 -156.9 171.1];
K4 = [-860.1 -2513.0 2264.4];
K5 = [-1572.8 -5143.3 4545.5];
L1 = [-833.0; -1711.2; 226.4];
L2 = [-3946.5; -8661.4; 664.6];
L3 = [287.9; 1056.9; 130.8];
L4 = [3649.3; 9859.3; 310.3];
L5 = [787.0; 2460.0; 199.0];

F1=[A-B*K1 -B*K1;zeros(size(A)) A-L1*C];
F2=[A-B*K2 -B*K2;zeros(size(A)) A-L2*C];
F3=[A-B*K3 -B*K3;zeros(size(A)) A-L3*C];
F4=[A-B*K4 -B*K4;zeros(size(A)) A-L4*C];
F5=[A-B*K5 -B*K5;zeros(size(A)) A-L5*C];

eig(F1)
eig(F2)
eig(F3)
eig(F4)
eig(F5)
%% 6.2.5
clear all ; clc
A = [-0.70 0.50 -0.20; -0.10 -0.90 -0.30; 0.30 0.10 0.00];
B = [0.50; -0.20; 0.80];
C = [-0.20 0.30 -0.70];
pObsv = [-3.00 -3.00 -5.00];
pCont = [-3.00 -1.00 -1.00];

transL=acker(transpose(A),transpose(C),pObsv);
L=transpose(transL);
K=acker(A,B,pCont);

kref=-inv(C*inv(A-B*K)*B);
F=[A-B*K -B*K;zeros(size(A)) A-L*C];
v=transpose(eig(F));

disp(mat2str(L))
disp(mat2str(K))
kref
disp(mat2str(v))
%% 6.2.6
clear all ; clc
A = [-0.50 0.70 0.30 0.30; -0.80 -0.40 -0.70 -0.50; 0.70 -0.80 0.80 -0.20; 0.80 0.00 0.40 -0.50];
B = [-0.50; -0.60; -0.80; 0.30];
C = [0.00 0.80 -0.60 -0.80];
K = [-197.40 269.70 40.70 344.40];
L = [87.60; 12.00; -163.20; 114.90];
t0 = 0.30;
h = 0.06;
xhat0 = [-0.10; 0.40; -1.00; 0.70];
r0 = -0.40;
y0 = [-0.50];

kref=-inv(C*inv(A-B*K)*B);

u0=-K*xhat0+kref*r0;

x_h=xhat0+(A*xhat0+B*u0-L*(C*xhat0-y0))*h;

disp(mat2str(u0))
disp(mat2str(x_h))