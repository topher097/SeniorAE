function FindCostWithQR
a = [-0.50 -0.10 0.20 -1.00; 0.10 -0.30 0.70 0.80; -0.70 0.20 -0.80 -1.00; -0.20 -0.90 0.20 -0.60];
b = [1.00 -0.60 0.10 -0.10; 0.30 -0.60 -0.70 0.70; -0.60 -0.60 -0.80 0.30; -0.10 -0.90 -0.20 -1.00];
k = [0.739461827622766 0.130184227196577 -0.225253460636075 -0.54450296609379;0.0356957890859032 -0.420012877123933 -0.216183777808933 -0.502968546251459;0.184134460459015 -0.551339769313655 -0.39154055691452 -0.0695901553448294;0.254919667982301 0.459672387927975 0.286305887091657 -0.804622419932415];
q = [3.40 -0.50 0.30 -0.25; -0.50 4.30 0.00 -0.20; 0.30 0.00 3.80 -0.55; -0.25 -0.20 -0.55 4.50];
r = [3.10 -0.45 0.25 -0.75; -0.45 3.60 0.40 0.00; 0.25 0.40 3.80 -0.75; -0.75 0.00 -0.75 4.60];
t0 = 0.80;
x0 = [0.66; -0.59; -0.54; 0.39];
cost = integral(@(t) integrand(t, a, b, k, q, r, t0, x0), t0, inf);
disp(mat2str(cost, 8));
end

function cost = integrand(t, a, b, k, q, r, t0, x0)
cost = zeros(size(t));
for i=1 : length(t)
    x = exp((a - b * k) * (t(i) - t0)) * x0;
    u = -k * x;
    cost(i) = q * x.^2 + r * u.^2;
end
end